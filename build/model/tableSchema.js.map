{"version":3,"sources":["../../server/model/tableSchema.js"],"names":["dotenv","config","env","process","NODE_ENV","configuration","connectionString","url","client","Client","connect","hashedPassword","bcrypt","hashSync","createTable","createTableText","query","err","message","end"],"mappings":";;AAAA;;AACA;;AACA;;AACA;;;;AACAA,mBAAOC,MAAP;;AAEA,IAAMC,GAAG,GAAGC,OAAO,CAACD,GAAR,CAAYE,QAAZ,IAAwB,aAApC;AACA,IAAMH,MAAM,GAAGI,mBAAcH,GAAd,CAAf;AACA,IAAMI,gBAAgB,GAAGL,MAAM,CAACM,GAAhC;AAGA,IAAMC,MAAM,GAAG,IAAIC,UAAJ,CAAWH,gBAAX,CAAf;AACAE,MAAM,CAACE,OAAP;;AACA,IAAMC,cAAc,GAAGC,mBAAOC,QAAP,CAAgB,QAAhB,EAA0B,EAA1B,CAAvB;;AAGA,IAAMC,WAAW,GAAG,SAAdA,WAAc,GAAM;AAE1B,MAAMC,eAAe,w3CA+C0BJ,cA/C1B,kIAkDuBA,cAlDvB,0YAArB;AAgEAH,EAAAA,MAAM,CAACQ,KAAP,CAAaD,eAAb,EAA8B,UAACE,GAAD,EAAS;AACrC,QAAIA,GAAJ,EAAS;AACP,aAAOA,GAAG,CAACC,OAAX;AACD;;AACDV,IAAAA,MAAM,CAACW,GAAP;AACD,GALD;AAOC,CAzED;;AA0EAL,WAAW","sourcesContent":["import { Client } from 'pg';\r\nimport dotenv from 'dotenv';\r\nimport bcrypt from 'bcrypt';\r\nimport configuration from '../config/config';\r\ndotenv.config();\r\n\r\nconst env = process.env.NODE_ENV || 'development';\r\nconst config = configuration[env];\r\nconst connectionString = config.url;\r\n\r\n\r\nconst client = new Client(connectionString);\r\nclient.connect();\r\nconst hashedPassword = bcrypt.hashSync('123456', 10);\r\n\r\n\r\nconst createTable = () => {\r\n\r\nconst createTableText = `\r\nDROP TABLE IF EXISTS users CASCADE;\r\n\r\nDROP TABLE IF EXISTS bus CASCADE;\r\n\r\nDROP TABLE IF EXISTS trips CASCADE;\r\n\r\nDROP TABLE IF EXISTS bookings CASCADE;\r\n\r\nCREATE TABLE IF NOT EXISTS users (\r\n  id SERIAL PRIMARY KEY,\r\n  firstname VARCHAR(155) NOT NULL,\r\n  lastname VARCHAR(155) NOT NULL,\r\n  email VARCHAR(155) NOT NULL,\r\n  password VARCHAR(155) NOT NULL,\r\n  isAdmin BOOLEAN DEFAULT false\r\n);\r\n\r\nCREATE TABLE IF NOT EXISTS bus(\r\n  id SERIAL PRIMARY KEY,\r\n  number_plate VARCHAR(155) NOT NULL,\r\n  manufacturer VARCHAR(155) NOT NULL,\r\n  model VARCHAR(155) NOT NULL,\r\n  year INTEGER NOT NULL,\r\n  capacity INTEGER NOT NULL\r\n);\r\n\r\nCREATE TABLE IF NOT EXISTS trips(\r\n  id SERIAL PRIMARY KEY,\r\n  busId int REFERENCES bus(id) ON DELETE CASCADE,\r\n  origin VARCHAR(155) NOT NULL,\r\n  destination VARCHAR(155) NOT NULL,\r\n  trip_date timestamptz NOT NULL DEFAULT CURRENT_TIMESTAMP,\r\n  fare INTEGER NOT NULL,\r\n  userId int REFERENCES users(id) ON DELETE CASCADE,\r\n  status VARCHAR(155) DEFAULT 'active'\r\n);\r\n\r\nCREATE TABLE IF NOT EXISTS bookings(\r\n  id SERIAL PRIMARY KEY,\r\n  tripid int REFERENCES trips(id) ON DELETE CASCADE,\r\n  userId int REFERENCES users(id) ON DELETE CASCADE,\r\n  seat_number INTEGER NOT NULL,\r\n  createdOn timestamptz NOT NULL DEFAULT CURRENT_TIMESTAMP\r\n  );\r\n  \r\n   INSERT INTO users(email, firstName, lastName, password, isAdmin)\r\n   VALUES('admin@test.com','Admin', 'Etim', '${hashedPassword}', true);\r\n  \r\n   INSERT INTO users(email, firstName, lastName, password)\r\n  VALUES('user@test.com','User', 'Etim', '${hashedPassword}');\r\n\r\n\r\n  INSERT INTO bus(number_plate, manufacturer, model, year, capacity)\r\n  VALUES('546ET6','Toyota','Corolla', 1998, 38);\r\n\r\n  INSERT INTO bus(number_plate, manufacturer, model, year, capacity)\r\n  VALUES('546ET7','Boyota','Borolla', 1999, 48);\r\n\r\n  INSERT INTO trips(busId, origin, destination, fare, trip_date,userId)\r\n  VALUES(1,'Yaba','Lago', 12, '2019-07-14T09:01:11.530Z',1)\r\n  `;\r\n\r\n\r\nclient.query(createTableText, (err) => {\r\n  if (err) {\r\n    return err.message;\r\n  }\r\n  client.end();\r\n});\r\n\r\n}\r\ncreateTable();\r\n\r\n\r\n"],"file":"tableSchema.js"}